<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>‚òÅÔ∏è Serverless Functions | A Workshop all about GraphQL</title>
    <meta name="description" content="">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.1c371215.css" as="style"><link rel="preload" href="/assets/js/app.7524a916.js" as="script"><link rel="preload" href="/assets/js/2.f8dac7df.js" as="script"><link rel="preload" href="/assets/js/10.8163466a.js" as="script"><link rel="prefetch" href="/assets/js/11.16c73e61.js"><link rel="prefetch" href="/assets/js/12.fbc0515a.js"><link rel="prefetch" href="/assets/js/13.be970c90.js"><link rel="prefetch" href="/assets/js/3.295021d7.js"><link rel="prefetch" href="/assets/js/4.dadc6ac6.js"><link rel="prefetch" href="/assets/js/5.57b65144.js"><link rel="prefetch" href="/assets/js/6.46c89de5.js"><link rel="prefetch" href="/assets/js/7.31fc7c42.js"><link rel="prefetch" href="/assets/js/8.3fd0fe42.js"><link rel="prefetch" href="/assets/js/9.9fc2ed40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c371215.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">A Workshop all about GraphQL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/workshop/1.html" class="sidebar-link">üçïIntroduction - What is GraphQL and Serverless?</a></li><li><a href="/workshop/2.html" class="sidebar-link">üîé The GraphQL API</a></li><li><a href="/workshop/3.html" class="sidebar-link">üì¶ Microservices and Docker</a></li><li><a href="/workshop/4.html" class="active sidebar-link">‚òÅÔ∏è Serverless Functions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/workshop/4.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/workshop/4.html#what-we-will-build" class="sidebar-link">What we will build</a></li><li class="sidebar-sub-header"><a href="/workshop/4.html#solution" class="sidebar-link">Solution</a></li></ul></li><li><a href="/workshop/5.html" class="sidebar-link">üöÄ Deploy your app</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="‚òÅÔ∏è-serverless-functions"><a href="#‚òÅÔ∏è-serverless-functions" aria-hidden="true" class="header-anchor">#</a> ‚òÅÔ∏è Serverless Functions</h1> <p>Serverless is about writing functions in the Cloud that are fully managed. Fully managed means all we focus on is code. There's no OS, app server or anything else we need to care about, just code. This is called FaaS, functions as a service.</p> <p>There are two important concepts we need to know about to learn about Azure Functions:</p> <ul><li><strong>Trigger</strong>, this is what starts the function, there are many things that can start a function like a HTTP request, a Queue message, a new database entry and so on</li> <li><strong>Bindings</strong>, bindings come in two different flavors input bindings and output bindings. The idea is to set up a connection to a data source with you not having to type any code to do so. Instead a JSON file is used to point things like connection string and exactly what data you want.
<ul><li><strong>Input binding</strong>, an <em>input</em> binding means that we are reading data from a data source</li> <li><strong>Output binding</strong>, this means we are writing data to a data source</li></ul></li></ul> <h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h2> <p>To start working with Azure Functions we need the following</p> <ul><li><strong>azure functions core tools</strong>, this is the core library</li> <li><strong>vs code extension</strong> (optional), this will however make authoring and deploying a whole lot easiser</li></ul> <h3 id="azure-functions-core-tools"><a href="#azure-functions-core-tools" aria-hidden="true" class="header-anchor">#</a> Azure Functions Core Tools</h3> <p>Installing this looks a bit different on Linux, Mac and Windows.</p> <p><strong>Mac</strong></p> <div class="language- extra-class"><pre class="language-text"><code>brew tap azure/functions 
brew install azure-functions-core-tools
</code></pre></div><p><strong>Windows</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm i -g azure-functions-core-tools --unsafe-perm true
</code></pre></div><p><strong>Ubuntu</strong></p> <div class="language- extra-class"><pre class="language-text"><code>wget -q https://packages.microsoft.com/config/ubuntu/19.04/packages-microsoft-prod.deb sudo dpkg -i packages-microsoft-prod.deb
</code></pre></div><h3 id="vs-code-extension"><a href="#vs-code-extension" aria-hidden="true" class="header-anchor">#</a> VS Code Extension</h3> <p>Install by going to this <a href="vscode:extension/ms-azuretools.vscode-azurefunctions">link</a> or open up VS Code and type <code>Azure Functions</code></p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--6RVfGE9v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/psz5ihp5kjyujpvq1qrq.png" alt=""></p> <h2 id="what-we-will-build"><a href="#what-we-will-build" aria-hidden="true" class="header-anchor">#</a> What we will build</h2> <p>We will do the following:</p> <ul><li><strong>Create</strong> an Azure Function</li> <li><strong>Integrate</strong> our GraphQL API</li> <li><strong>Add</strong> external endpoints to our GraphQL API</li></ul> <h3 id="create-an-azure-function"><a href="#create-an-azure-function" aria-hidden="true" class="header-anchor">#</a> Create an Azure Function</h3> <p>We will use the fact that we have installed the Azure Function VS Code extension. It comes with some valuable commands that will help us scaffold the function we need.</p> <p><strong>Scaffold an Azure Function App + Function</strong></p> <p>An Azure Function needs to be hosted in an Azure Function App. To create an open up the Command Palette in VS Code (CTRL/CMD + SHIFT + P) or View/Command Palette. Thereafter type <code>Azure Functions: Create New Project</code> and select that.</p> <p><strong>First</strong>, you will be prompted to what folder contains your project. The normal choice is the folder you are standing in.</p> <p><img src="https://cdn-images-1.medium.com/max/1024/1%2AyCAYfl2xSaU1XMs4nox__g.png" alt=""></p> <p><strong>Secondly</strong>, you are asked for what programming language you want the project to be, select <code>C#</code></p> <p><img src="https://cdn-images-1.medium.com/max/1024/1%2Ao0DqKyhGpjPYG6Owd_hAQQ.png" alt=""></p> <p><strong>Thirdly</strong>, you are asked for what template to use for your first function in your Azure Functions project. Select <code>HttpTrigger</code></p> <p><img src="https://cdn-images-1.medium.com/max/1024/1%2AtOj9evR2VzUHN3769auafg.png" alt=""></p> <p><strong>Fourth</strong>, now it's asking what to name our function, we name it <code>GraphQL</code>, but you can name whatever you want</p> <p><img src="https://cdn-images-1.medium.com/max/1024/1%2AByRKpClyIg18VocVthLlIw.png" alt=""></p> <p><strong>Fifth</strong>, lastly it's asking you for authhorization level, essentially what credentials you need to pass to be able to call it. Select <em>anonymous</em></p> <p><img src="https://cdn-images-1.medium.com/max/1024/1%2AwE6QFcXxhHWn928Tf90gPQ.png" alt=""></p> <p>Now, we should have project overview looking something like this:</p> <div class="language- extra-class"><pre class="language-text"><code>.vscode/
GraphQL/ -- this is our function
  function.json -- this a bindings config file
  index.js -- this is our Azure Function
.funcignore
host.json
local.settings.json -- this contains app settings keys
GraphQL.cs
</code></pre></div><h3 id="integrate-graphql"><a href="#integrate-graphql" aria-hidden="true" class="header-anchor">#</a> Integrate GraphQL</h3> <p>So how do we go about integrating GraphQL?</p> <p>We need to do the following:</p> <ul><li><strong>Move</strong> in the GraphQL files into our Azure project</li> <li><strong>Remove</strong> the part where Apollo hosts the web server</li> <li><strong>Update Azure Function</strong> with call to GraphQL</li> <li><strong>Add</strong> the needed libraries, i.e <code>GraphQL</code></li></ul> <p><strong>Move files</strong></p> <p>We simply move in our files into this structure, like so.</p> <div class="language- extra-class"><pre class="language-text"><code>.vscode/
API/
  Data.cs
  Mutation.cs
  Query.cs
  Schema.cs
.funcignore
host.json
local.settings.json 
</code></pre></div><p>Let's highlight our addition:</p> <div class="language- extra-class"><pre class="language-text"><code>API/
  Data.cs
  Mutation.cs
  Query.cs
  Schema.cs
</code></pre></div><p><strong>Update Azure Function</strong></p> <p>Let's have a look at our Azure function:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// GraphQL.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging<span class="token punctuation">;</span>
<span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Microsoft
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GraphQL</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token class-name">FunctionName</span><span class="token punctuation">(</span><span class="token string">&quot;GraphQL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>IActionResult<span class="token operator">&gt;</span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token class-name">HttpTrigger</span><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Anonymous<span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token class-name">HttpRequest</span> req<span class="token punctuation">,</span>
            <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;C# HTTP trigger function processed a request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">string</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>Query<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">string</span> requestBody <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">dynamic</span> data <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">DeserializeObject</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name <span class="token operator">??</span> data<span class="token punctuation">?.</span>name<span class="token punctuation">;</span>

            <span class="token keyword">string</span> responseMessage <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                <span class="token punctuation">?</span> <span class="token string">&quot;This HTTP triggered function executed successfully. Pass a name in the query string or in the request body for a personalized response.&quot;</span>
                <span class="token punctuation">:</span> $<span class="token string">&quot;Hello, {name}. This HTTP triggered function executed successfully.&quot;</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OkObjectResult</span><span class="token punctuation">(</span>responseMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Let's update it to start using GraphQL. What we want to achieve is the following:</p> <ul><li><strong>read</strong> query parameter <code>query</code></li> <li><strong>use</strong> value of <code>query</code> to query our GraphQL server</li> <li><strong>respond</strong> with data from GraphQL Server</li></ul> <p>Given the above agenda, let's change <code>GraphQL.cs</code> to the following:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// GraphQL.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging<span class="token punctuation">;</span>
<span class="token keyword">using</span> GraphQL<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Microsoft
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GraphQL</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token class-name">FunctionName</span><span class="token punctuation">(</span><span class="token string">&quot;GraphQL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>IActionResult<span class="token operator">&gt;</span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token class-name">HttpTrigger</span><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Anonymous<span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token class-name">HttpRequest</span> req<span class="token punctuation">,</span>
            <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;C# HTTP trigger function processed a request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">string</span> query <span class="token operator">=</span> req<span class="token punctuation">.</span>Query<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> schema <span class="token operator">=</span> SchemaFactory<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> json <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                _<span class="token punctuation">.</span>Query <span class="token operator">=</span> query<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OkObjectResult</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Install GraphQL NuGet</strong></p> <p>We need to update our project to use the <code>GraphQL</code> NuGet</p> <div class="language- extra-class"><pre class="language-text"><code>dotnet add package GraphQL
</code></pre></div><h3 id="add-external-endpoints"><a href="#add-external-endpoints" aria-hidden="true" class="header-anchor">#</a> Add external endpoints</h3> <p>We need to realize the following. We have built two micro services that we can now use, so we no longer need to use the in-memory data. To use them we need to do the following:</p> <ul><li>Change code for <code>products</code> and <code>reviews</code> to do HTTP requests</li> <li>Create a nice <code>HttpHelper</code> class that easily lets us fetch the JSON data we need</li> <li>Get a JSON parsing lib</li></ul> <p><strong>Install JSON lib</strong></p> <div class="language- extra-class"><pre class="language-text"><code>dotnet add package System.Text.Json
</code></pre></div><p><strong>Create a HttpHelper</strong></p> <p>Add the following to <code>Query.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// to the top</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>


<span class="token comment">// somewhere in the code</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpHelper</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> ValueTask<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token generic-method"><span class="token function">Get</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">string</span> url<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonSerializerOptions</span>
      <span class="token punctuation">{</span>
        PropertyNameCaseInsensitive <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> streamTask <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetStreamAsync</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DeserializeAsync</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">await</span> streamTask<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>The above will allow us to easily specify a URL and a return type. We will see later how this <code>HttpHelper</code> class will pay off.</p> <p><strong>Replace static data with HTTP requests</strong></p> <p>Keep working on <code>Query.cs</code>, this time ensure the method <code>GetProducts()</code> looks like this:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">GraphQLMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Product<span class="token operator">&gt;&gt;</span> <span class="token function">GetProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span>  <span class="token keyword">await</span> HttpHelper<span class="token punctuation">.</span>Get<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Product<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>and <code>GetReviews()</code> should look like this:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">GraphQLMetadata</span><span class="token punctuation">(</span><span class="token string">&quot;reviews&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Review<span class="token operator">&gt;&gt;</span> <span class="token function">GetReviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> HttpHelper<span class="token punctuation">.</span>Get<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Review<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>lastly go into our <code>ReviewResolver</code> class and change the <code>Product()</code> method to say this:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>Product<span class="token operator">&gt;</span> <span class="token function">Product</span><span class="token punctuation">(</span><span class="token class-name">ResolveFieldContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Review</span> review<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> products <span class="token operator">=</span> <span class="token keyword">await</span> HttpHelper<span class="token punctuation">.</span>Get<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Product<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> products<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>Id <span class="token operator">==</span> review<span class="token punctuation">.</span>Product<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="try-it-out"><a href="#try-it-out" aria-hidden="true" class="header-anchor">#</a> Try it out</h3> <p>Ensure you have started up the Micro services from part3 with</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up
</code></pre></div><p>Ensure you they respond to <code>http://localhost:8000</code> and <code>http://localhost:8001</code> respectively.</p> <p>Let's start the debugger for the Azure Function</p> <p>Now type the below <code>URL</code></p> <div class="language- extra-class"><pre class="language-text"><code>http://localhost:7071/api/GraphQL?query={ reviews { title, grade, product { name } } }
</code></pre></div><p>This nested query should now resolve by querying both our products endpoint and our reviews endpoint.</p> <h2 id="solution"><a href="#solution" aria-hidden="true" class="header-anchor">#</a> Solution</h2> <p><a href="https://github.com/softchris/graphql-workshop-dotnet/tree/master/part4/solution" target="_blank" rel="noopener noreferrer">SOLUTION workshop part 4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/5/2020, 5:56:09 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ‚Üê
        <a href="/workshop/3.html" class="prev">
          üì¶ Microservices and Docker
        </a></span> <span class="next"><a href="/workshop/5.html">
          üöÄ Deploy your app
        </a>
        ‚Üí
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7524a916.js" defer></script><script src="/assets/js/2.f8dac7df.js" defer></script><script src="/assets/js/10.8163466a.js" defer></script>
  </body>
</html>
